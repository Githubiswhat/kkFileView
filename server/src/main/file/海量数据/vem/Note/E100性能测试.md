### 一. 测试工具

测试采用 Jmeter + 模拟prometheus远程读写的http请求的jar包

该工具可以测试不同并发度下，数据写入和查询的各项性能指标。

模拟prometheus远程读写的http请求的流程

![img](https://segmentfault.com/img/bVcUFgc)

### 二. 测试环境

部署了E100和Adapter的服务器， CPU，内存及磁盘大小待定

### 三. 测试场景

测试所用数据模型模拟VEM后端采集来的的数据模型

模拟的数据结构类型如下：

```
<--------------- metric -----------------------><-timestamp -><-value->
http_request_total_0{status="200", method="GET"}@1434417560938 => 94350
http_request_total_1{status="200", method="GET"}@1434417560938 => 94351
http_request_total_2{status="200", method="GET"}@1434417560938 => 94352
http_request_total_3{status="200", method="GET"}@1434417560938 => 94353
http_request_total_4{status="200", method="GET"}@1434417560938 => 94354
http_request_total_5{status="200", method="GET"}@1434417560938 => 94355
http_request_total_6{status="200", method="GET"}@1434417560938 => 94356
http_request_total_7{status="200", method="GET"}@1434417560938 => 94357
http_request_total_8{status="200", method="GET"}@1434417560938 => 94358
http_request_total_9{status="200", method="GET"}@1434417560938 => 94359
```

**测试指标介绍**

介绍该测试中对于写入以及查询的性能指标。

#### **写入PPS**

- 向数据库中执行写入时，平均每秒钟写入的测量数据点数（Points-per-second）。

  为统一时序数据的写入测量单位，本次测试统一以单值模型的测量点数量来进行统计。

  以上述数据模型为例，基于单值模型的时序数据，每次http请求上报一次数据包含十个测量值。

  因此其一次上报数据的数据量计为 10（**数据点**）。

  因此在该数据模型下， `10PPS = 1TPS(Tuples-per-second)`。

​	测试：在固定并发下的PPS，调整每个线程发送的请求个数

- 1个线程
  - 100个请求
  - 1000个请求
  - 10000个请求
- 5个线程
  - 100个请求
  - 1000个请求
  - 10000个请求
- 10个线程
  - 100个请求
  - 1000个请求
  - 10000个请求
- 20个线程
  - 100个请求
  - 1000个请求
  - 10000个请求
- 30个线程
  - 100个请求
  - 1000个请求
  - 10000个请求

#### **查询**QPS

衡量方法为：对于各用例指定的查询总数 (points) / 查询完成的时间。

场景：

场景一：指标，查看指标在不同的时间跨度所花费的时间

- 查看单个指标

  时间跨度分别为1H 、12H、 24H、48H

  记录查询到的points 和 花费的时间（ms）

- 查看10个指标

  时间跨度分别为1H 、12H、 24H、48H

  记录查询到的points 和 花费的时间（ms）

- 查看100个指标

  时间跨度分别为1H 、12H、 24H、48H

  记录查询到的points 和 花费的时间（ms）

  

#### **磁盘压缩**

​	以上述基于单值模型的时序数据，每次上传一次数据包含十个测量值为例。

​	计算十个测量值的字节数，乘以总的发送的次数，得到总的发送的数据量。

​	查看E100时序数据库的磁盘使用量，计算数据的压缩比。



#### **内存**

​	测试随着写入的PPS的变化，内存的使用情况。



#### **CPU**

​	测试随着写入的PPS的变化，CPU的使用情况。























